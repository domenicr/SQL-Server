SET ANSI_NULLS ON 
GO 
SET QUOTED_IDENTIFIER ON 
GO 
CREATE FUNCTION [dbo].[SubStringRev] ( 
   -- Add the parameters for the function here 
   @pString VARCHAR(MAX), 
   @nEnd BIGINT,
   @nLen BIGINT
) 
RETURNS VARCHAR(MAX)
AS 
   BEGIN 
      -- Declare the return variable here 
      DECLARE @vStart BIGINT 
      DECLARE @vString VARCHAR(MAX)
 
      --validate @nEnd
      --IF @nEnd > LEN(@pString+'*')-1
      --   SET @nEnd = LEN(@pString+'*')-1
      --SET @nEnd = ISNULL(@nEnd, LEN(@pString+'*')-1)
      
      --calc start
      SET @vStart = (@nEnd - @nLen) + 1
      
      SET @vString = SUBSTRING(@pString, @vStart, @nLen)
      
      -- Return the result of the function 
      RETURN @vString

 
   END 
GO 
